<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emoji Encryptor/Decryptor</title>

    <style>
      body {
        max-width: max-content;
        margin: auto;
        background-color: beige;
      }

      nav {
        display: flex;
        justify-content: space-between;
        gap: 10%;
      }

      .modeButton {
        border-radius: 25px;
        font-weight: bold;
      }

      .modeButton:hover {
        background-color: #808080;
      }

      section {
        display: flex;
        flex-direction: column;
      }

      #outputArea {
        background-color: gainsboro;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Emoji Encryptor/Decryptor</h1>
    </header>

    <nav>
      <button
        type="button"
        id="encryptButton"
        class="modeButton"
        onclick="encryptMode()"
      >
        Encrypt Mode
      </button>
      <button
        type="button"
        id="decryptButton"
        class="modeButton"
        onclick="decryptMode()"
      >
        Decrypt Mode
      </button>
    </nav>

    <br />
    <br />

    <section>
      <!-- Input -->
      <input id="textInput" type="text" placeholder="" />
      <input id="keyInput" type="number" placeholder="" />

      <br />
      <br />
      <button type="button" id="generateButton" onclick="generate()"></button>
      <br />
      <br />

      <!-- Output -->
      <div
        id="outputArea"
        style="border: 1px solid black; width: 100%; height: 100px"
      ></div>
    </section>

    <script>
      var encryptButton = document.getElementById("encryptButton");
      var decryptButton = document.getElementById("decryptButton");

      var mode = "enc";
      var textInput = document.getElementById("textInput");
      var keyInput = document.getElementById("keyInput");
      var generateButton = document.getElementById("generateButton");
      var outputArea = document.getElementById("outputArea");

      function encryptMode(textInputParam = "Text to Encrypt...") {
        mode = "enc";
        textInput.placeholder = textInputParam;
        keyInput.hidden = true;
        generateButton.innerText = "Encrypt";

        encryptButton.style.backgroundColor = "#808080";
        decryptButton.style.backgroundColor = "#f0f0f0";
      }

      function decryptMode(
        textInputParam = "Text to Decrypt...",
        keyInputParam = "Key for Decryption..."
      ) {
        mode = "dec";
        textInput.placeholder = textInputParam;
        keyInput.hidden = false;
        keyInput.placeholder = keyInputParam;
        generateButton.innerText = "Decrypt";

        decryptButton.style.backgroundColor = "#808080";
        encryptButton.style.backgroundColor = "#f0f0f0";
      }

      function generate() {
        // request flask api to encrypt-decrypt via GET.
        if (mode === "enc") {
          fetch(`/api/encrypt?data=${textInput.value}`)
            .then(function (response) {
              return response.json();
            })
            .then(function (text) {
              display(text.mode, text.input, text.output, text.key);
            });
        } else {
          fetch(`/api/decrypt?data=${textInput.value}&key=${keyInput.value}`)
            .then(function (response) {
              return response.json();
            })
            .then(function (text) {
              display(text.mode, text.input, text.output, text.key);
            });
        }
      }

      function display(mode, input, output, key = undefined) {
        if (mode === "enc") {
          // retrieved encrypted data
          encryptMode(input);
          outputArea.innerHTML = `${output}<br/><br/>Key=${key}`;
        } else if (mode === "dec") {
          // retrieved decrypted data
          decryptMode(input, key);
          outputArea.innerHTML = `${output}`;
        } else encryptMode(); // default mode
      }

      display("{{ mode }}", "{{ input }}", "{{ output }}", "{{ key }}");
    </script>
  </body>
</html>
